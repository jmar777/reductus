{"version":3,"file":"reductus.js","sources":["../src/index.js","../node_modules/redux-cake/dist/redux-cake.js","../node_modules/reselect/lib/index.js","../src/get-object-keys.js","../src/get-bound-method.js","../src/validators.js"],"sourcesContent":["import { addSlice, reduxCake, combineReducers } from 'redux-cake';\nimport { createSelector } from 'reselect';\nimport getObjectKeys from './get-object-keys';\nimport getBoundMethod from './get-bound-method';\nimport asap from './asap';\nimport * as validators from './validators';\n\nconst SLICE_ADDED = '@@redux-cake/SLICE_ADDED';\n\nlet store;\n\n/**\n * A decorator for marking methods on service definitions as selectors.\n * The selector definition accepts a callback function that receives the\n * service instance, and should return an array of input selectors (in\n * `reselect` terms). The results of the input selectors will be passed\n * the function body.\n */\nexport const selector = getInputSelectors => (target, key, descriptor) => {\n  validators.validateSelectorDecoratorParams(getInputSelectors);\n  validators.validateSelectorDecoratorTarget(target, key, descriptor);\n\n  descriptor.value._reductusSelector = { getInputSelectors };\n};\n\n/**\n * A decorator for marking methods on service definitions as reducers. Reducers\n * will not be exposed on the service's public API, but will receive dispatched\n * actions when the action type matches the (optional) type provided to the\n * decorator, or the method name if the type is excluded.\n */\nexport const reducer = type => (target, key, descriptor) => {\n  validators.validateReducerDecoratorParams(type);\n  validators.validateReducerDecoratorTarget(target, key, descriptor);\n\n  descriptor.value._reductusReducer = { type: type || key };\n};\n\n/**\n * A decorator that will convert a class definition into a Service factory.\n */\nexport const service = (slice, initialState) => clazz => {\n  validators.validateServiceDecoratorParams(slice, initialState);\n  validators.validateServiceDecoratorTarget(clazz);\n\n  const reducers = {};\n\n  const proto = clazz.prototype;\n\n  proto.state = () => {\n    assertStore();\n\n    return store.getState()[slice];\n  };\n\n  proto.slice = (state) => {\n    assertStore();\n\n    if (!state) {\n      throw new Error('Cannot call slice() without providing the \"state\" parameter');\n    }\n\n    return state[slice];\n  };\n\n  proto.dispatch = (type, payload, meta) => {\n    assertStore();\n\n    // check if we're dispatching a raw action\n    if (typeof type !== 'string') {\n      return store.dispatch(type);\n    }\n\n    const action = { type };\n\n    if (payload instanceof Error) {\n      action.error = true;\n    }\n\n    if (typeof payload !== 'undefined') {\n      action.payload = payload;\n    }\n\n    if (typeof meta !== 'undefined') {\n      action.meta = meta;\n    }\n\n    return store.dispatch(action);\n  };\n\n  getObjectKeys(proto).forEach(key => {\n    if (key === 'constructor') return;\n\n    const descriptor = Object.getOwnPropertyDescriptor(proto, key);\n\n    if (typeof descriptor.value !== 'function') return;\n\n    const fn = descriptor.value;\n\n    if (fn._reductusSelector) {\n      const { getInputSelectors } = fn._reductusSelector;\n\n      let selector;\n\n      // note: we wrap the selector function so that we can lazily invoke\n      // `getInputSelectors`. this is primarily done to allow any remaining service\n      // methods to be processed by this loop before selectors start grabbing\n      // references to their \"input selectors\"\n      descriptor.value = function(...args) {\n        if (selector) return selector(...args);\n\n        selector = createSelector(getInputSelectors(this), fn.bind(this));\n\n        return selector(...args);\n      };\n\n      Object.defineProperty(proto, key, getBoundMethod(clazz, key, descriptor));\n    }\n    else if (fn._reductusReducer) {\n      // @todo: reducers aren't yet bound to the service instance\n      reducers[fn._reductusReducer.type] = fn;\n      delete proto[key];\n    }\n    else {\n      // autobind all remaining class methods\n      Object.defineProperty(proto, key, getBoundMethod(clazz, key, descriptor));\n    }\n  });\n\n  let instance;\n\n  clazz.get = () => {\n    if (instance) return instance;\n\n    instance = new clazz();\n\n    // most of the time our services are registered before the enhancer has had\n    // a chance to be applied, so we wait a tick before trying to add the slice\n    addSlice(slice, (state, action) => {\n      // honor `combineReducers()` state initilization procedure\n      if (typeof state === 'undefined') {\n        return initialState;\n      }\n\n      // call onStateAvailable() once the slice has been successfully added.\n      // note: we invoke it on a future turn, as we're currently in a reducer,\n      // so we don't want to let consumers call dispatch() right now (which is\n      // a likely use case for this callback).\n      if (\n        instance.onStateAvailable &&\n        action.type === SLICE_ADDED &&\n        action.payload === slice\n      ) {\n        instance.onStateAvailable();\n      }\n\n      // bail if we don't have a specific reducer for this\n      if (!reducers[action.type]) {\n        return state;\n      }\n\n      return reducers[action.type].call(instance, state, action);\n    });\n\n    return instance;\n  };\n};\n\n/**\n * The store enhancer used to enable dynamic slice management, dispatching,\n * and state access.\n */\nexport const reductusEnhancer = createStore => {\n  const wrappedCreateStore = (...args) => {\n    store = createStore(...args);\n    return store;\n  };\n\n  return reduxCake(wrappedCreateStore);\n};\n\n/**\n * A wrapper around Redux's `combineReducers` implementation, giving us a\n * chance to intercept key actions, as well as grab a reference to the\n * raw reducers object.\n */\nexport { combineReducers };\n\n// verifies that the store has been initialized (and thus asserting that\n// the reductus enhaner has already been used)\nfunction assertStore() {\n  if (!store) {\n    throw new Error('You must use the reductus enhancer before calling reductus Service methods');\n  }\n}\n","!function(e,r){\"object\"==typeof exports&&\"undefined\"!=typeof module?r(exports,require(\"redux\")):\"function\"==typeof define&&define.amd?define([\"exports\",\"redux\"],r):r(e[\"redux-cake\"]={},e.redux)}(this,function(e,r){\"use strict\";function n(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}var o=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},u=void 0,t=void 0,i=[],c=void 0,d=null,a={SLICE_ADDED:\"@@redux-cake/SLICE_ADDED\",SLICE_REMOVED:\"@@redux-cake/SLICE_REMOVED\"},l=function(e){e||(e={}),e[\"@@redux-cake\"]||(e[\"@@redux-cake\"]=function(e){return null});var n=r.combineReducers(e),u=function(e,r){return r&&\"@@redux/INIT\"===r.type&&d&&delete(e=o({},e))[d],n(e,r)};return u.originalReducers=e,u},f=function(){c||(c=setTimeout(function(){console.warn(\"It looks like you forgot to use the reduxCake store enhancer!\")},1e3))};e.ActionTypes=a,e.reduxCake=function(e){return function(r,n,o){if(!r.originalReducers)throw new Error(\"Redux Cake only works if you use our `combineReducers` function!\");return u=e(r,n,o),t=r.originalReducers,clearTimeout(c),i.forEach(function(e){return e()}),i.length=0,u}},e.addSlice=function e(r,c){if(!u)return f(),void i.push(function(){return e(r,c)});t[r]?console.warn('There is already a slice with key \"'+r+'\". This slice was ignored.'):(t=o({},t,n({},r,c)),u.replaceReducer(l(t)),u.dispatch({type:a.SLICE_ADDED,payload:r}))},e.removeSlice=function e(r){if(!u)return f(),void i.push(function(){return e(r)});t[r]&&(delete(t=o({},t))[r],d=r,u.replaceReducer(l(t)),d=null,u.dispatch({type:a.SLICE_REMOVED,payload:r}))},e.combineReducers=l,Object.defineProperty(e,\"__esModule\",{value:!0})});\n//# sourceMappingURL=redux-cake.js.map\n","'use strict';\n\nexports.__esModule = true;\nexports.defaultMemoize = defaultMemoize;\nexports.createSelectorCreator = createSelectorCreator;\nexports.createStructuredSelector = createStructuredSelector;\nfunction defaultEqualityCheck(a, b) {\n  return a === b;\n}\n\nfunction areArgumentsShallowlyEqual(equalityCheck, prev, next) {\n  if (prev === null || next === null || prev.length !== next.length) {\n    return false;\n  }\n\n  // Do this in a for loop (and not a `forEach` or an `every`) so we can determine equality as fast as possible.\n  var length = prev.length;\n  for (var i = 0; i < length; i++) {\n    if (!equalityCheck(prev[i], next[i])) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction defaultMemoize(func) {\n  var equalityCheck = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defaultEqualityCheck;\n\n  var lastArgs = null;\n  var lastResult = null;\n  // we reference arguments instead of spreading them for performance reasons\n  return function () {\n    if (!areArgumentsShallowlyEqual(equalityCheck, lastArgs, arguments)) {\n      // apply arguments instead of spreading for performance.\n      lastResult = func.apply(null, arguments);\n    }\n\n    lastArgs = arguments;\n    return lastResult;\n  };\n}\n\nfunction getDependencies(funcs) {\n  var dependencies = Array.isArray(funcs[0]) ? funcs[0] : funcs;\n\n  if (!dependencies.every(function (dep) {\n    return typeof dep === 'function';\n  })) {\n    var dependencyTypes = dependencies.map(function (dep) {\n      return typeof dep;\n    }).join(', ');\n    throw new Error('Selector creators expect all input-selectors to be functions, ' + ('instead received the following types: [' + dependencyTypes + ']'));\n  }\n\n  return dependencies;\n}\n\nfunction createSelectorCreator(memoize) {\n  for (var _len = arguments.length, memoizeOptions = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    memoizeOptions[_key - 1] = arguments[_key];\n  }\n\n  return function () {\n    for (var _len2 = arguments.length, funcs = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      funcs[_key2] = arguments[_key2];\n    }\n\n    var recomputations = 0;\n    var resultFunc = funcs.pop();\n    var dependencies = getDependencies(funcs);\n\n    var memoizedResultFunc = memoize.apply(undefined, [function () {\n      recomputations++;\n      // apply arguments instead of spreading for performance.\n      return resultFunc.apply(null, arguments);\n    }].concat(memoizeOptions));\n\n    // If a selector is called with the exact same arguments we don't need to traverse our dependencies again.\n    var selector = defaultMemoize(function () {\n      var params = [];\n      var length = dependencies.length;\n\n      for (var i = 0; i < length; i++) {\n        // apply arguments instead of spreading and mutate a local list of params for performance.\n        params.push(dependencies[i].apply(null, arguments));\n      }\n\n      // apply arguments instead of spreading for performance.\n      return memoizedResultFunc.apply(null, params);\n    });\n\n    selector.resultFunc = resultFunc;\n    selector.recomputations = function () {\n      return recomputations;\n    };\n    selector.resetRecomputations = function () {\n      return recomputations = 0;\n    };\n    return selector;\n  };\n}\n\nvar createSelector = exports.createSelector = createSelectorCreator(defaultMemoize);\n\nfunction createStructuredSelector(selectors) {\n  var selectorCreator = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : createSelector;\n\n  if (typeof selectors !== 'object') {\n    throw new Error('createStructuredSelector expects first argument to be an object ' + ('where each property is a selector, instead received a ' + typeof selectors));\n  }\n  var objectKeys = Object.keys(selectors);\n  return selectorCreator(objectKeys.map(function (key) {\n    return selectors[key];\n  }), function () {\n    for (var _len3 = arguments.length, values = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      values[_key3] = arguments[_key3];\n    }\n\n    return values.reduce(function (composition, value, index) {\n      composition[objectKeys[index]] = value;\n      return composition;\n    }, {});\n  });\n}","export default obj => {\n  let keys = Object.getOwnPropertyNames(obj);\n\n  if (typeof Object.getOwnPropertySymbols === 'function') {\n    keys = keys.concat(Object.getOwnPropertySymbols(obj));\n  }\n\n  return keys;\n};\n","// yanked from https://github.com/andreypopp/autobind-decorator/blob/master/src/index.js (MIT)\n\n/**\n * Return a descriptor removing the value and returning a getter\n * The getter will return a .bind version of the function\n * and memoize the result against a symbol on the instance\n */\nexport default (target, key, descriptor) => {\n  let fn = descriptor.value;\n\n  // In IE11 calling Object.defineProperty has a side-effect of evaluating the\n  // getter for the property which is being replaced. This causes infinite\n  // recursion and an \"Out of stack space\" error.\n  let definingProperty = false;\n\n  return {\n    configurable: true,\n    get() {\n      if (definingProperty || this === target.prototype || this.hasOwnProperty(key)\n        || typeof fn !== 'function') {\n        return fn;\n      }\n\n      let boundFn = fn.bind(this);\n      definingProperty = true;\n      Object.defineProperty(this, key, {\n        configurable: true,\n        get() {\n          return boundFn;\n        },\n        set(value) {\n          fn = value;\n          delete this[key];\n        }\n      });\n      definingProperty = false;\n      return boundFn;\n    },\n    set(value) {\n      fn = value;\n    }\n  };\n};\n","//\n// @selector()\n//\n\nexport const validateSelectorDecoratorParams = getInputSelectors => {\n  if (typeof getInputSelectors === 'undefined') {\n    throw new Error('The getInputSelectors parameter for @selector() is required.');\n  }\n\n  if (typeof getInputSelectors !== 'function') {\n    throw new Error('Expected the getInputSelectors parameter for @selector() to be a function');\n  }\n};\n\nexport const validateSelectorDecoratorTarget = (target, key, descriptor) => {\n  if (!descriptor || typeof descriptor.value !== 'function' || typeof target.constructor !== 'function') {\n    throw new Error('@selector() may only be used on class methods.');\n  }\n};\n\n//\n// @reducer()\n//\n\nexport const validateReducerDecoratorParams = type => {\n  if (type && typeof type !== 'string') {\n    throw new Error('Unexpected non-string `type` provided to @reducer().');\n  }\n};\n\nexport const validateReducerDecoratorTarget = (target, key, descriptor) => {\n  if (!descriptor || typeof descriptor.value !== 'function' || typeof target.constructor !== 'function') {\n    throw new Error('@reducer() may only be used on class methods.');\n  }\n};\n\n//\n// @service()\n//\n\nexport const validateServiceDecoratorParams = (slice, initialState) => {\n  if (typeof slice !== 'string') {\n    throw new Error('The first parameter (slice) for @service() must be a string.');\n  }\n\n  if (typeof initialState === 'undefined') {\n    throw new Error('The second second parameter (initialState) for @service() is required.');\n  }\n};\n\nexport const validateServiceDecoratorTarget = clazz => {\n  if (typeof clazz !== 'function' || typeof clazz.prototype.constructor !== 'function') {\n    throw new Error('@service() may only be used on ES6 classes.');\n  }\n\n  ['state', 'slice', 'dispatch'].forEach(key => {\n    if (clazz.prototype[key]) {\n      throw new Error(`\"${key}\" is a reserved method name on Reductus services.`);\n    }\n  });\n};\n"],"names":["assertStore","store","Error","e","r","exports","require$$0","this","n","Object","defineProperty","value","enumerable","configurable","writable","o","assign","arguments","length","prototype","hasOwnProperty","call","u","t","i","c","d","a","SLICE_ADDED","SLICE_REMOVED","l","combineReducers","type","originalReducers","f","setTimeout","console","warn","ActionTypes","reduxCake","clearTimeout","forEach","addSlice","push","replaceReducer","dispatch","payload","removeSlice","defaultEqualityCheck","b","areArgumentsShallowlyEqual","equalityCheck","prev","next","defaultMemoize","func","undefined","lastArgs","lastResult","apply","getDependencies","funcs","dependencies","Array","isArray","every","dep","dependencyTypes","map","join","createSelectorCreator","memoize","_len","memoizeOptions","_key","_len2","_key2","recomputations","resultFunc","pop","memoizedResultFunc","concat","selector","params","resetRecomputations","selectors","selectorCreator","createSelector","objectKeys","keys","key","_len3","values","_key3","reduce","composition","index","getOwnPropertyNames","obj","getOwnPropertySymbols","target","descriptor","fn","definingProperty","boundFn","bind","validateSelectorDecoratorParams","getInputSelectors","validateSelectorDecoratorTarget","constructor","validateReducerDecoratorParams","validateReducerDecoratorTarget","validateServiceDecoratorParams","slice","initialState","validateServiceDecoratorTarget","clazz","_reductusSelector","_reductusReducer","reducers","proto","state","getState","meta","action","error","getOwnPropertyDescriptor","getBoundMethod","instance","get","onStateAvailable","createStore"],"mappings":"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"}